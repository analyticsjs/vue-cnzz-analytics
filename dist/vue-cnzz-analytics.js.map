{"version":3,"file":"vue-cnzz-analytics.js","sources":["../src/modules/cnzz.ts","../src/modules/pushCNZZ.ts","../src/modules/getVueVersion.ts","../src/main.ts"],"sourcesContent":["/** \r\n * 定义基础配置\r\n * 官方文档 https://developer.umeng.com/docs/67963/detail/74517\r\n */\r\nclass CNZZ {\r\n  siteId: number;\r\n  isDebug: boolean;\r\n\r\n  constructor (siteId: number = 0, isDebug: boolean = false) {\r\n    this.siteId = siteId;\r\n    this.isDebug = isDebug;\r\n  }\r\n\r\n  /** \r\n   * 初始化\r\n   */\r\n  init () {\r\n    window._czc = window._czc ? window._czc : [];\r\n    const SCRIPT = document.createElement('script');\r\n    SCRIPT['async'] = true;\r\n    SCRIPT['src'] = `https://s9.cnzz.com/z_stat.php?id=${this.siteId}&web_id=${this.siteId}`;\r\n    document.querySelector('head').appendChild(SCRIPT);\r\n\r\n    if ( this.isDebug ) {\r\n      console.log(`[vue-cnzz-analytics] siteId load done.\\nsiteId:    ${this.siteId}`);\r\n    }\r\n  }\r\n\r\n  /** \r\n   * 设置要响应的站点\r\n   */\r\n  setAccount () {\r\n    window._czc.push(['_setAccount', this.siteId]);\r\n  }\r\n\r\n  /** \r\n   * 提交PV、UV\r\n   */\r\n  trackPageview (pageUrl: string, fromUrl?: string) {\r\n    // 如果页面链接没传或者无效链接，则默认为根域名\r\n    if ( !pageUrl || typeof pageUrl !== 'string' ) {\r\n      pageUrl = '/';\r\n    }\r\n\r\n    // 如果页面链接带上了域名，则需要过滤掉\r\n    if ( pageUrl.includes('http') ) {\r\n      const PAGE_CUT = pageUrl.split('/');\r\n      const HOST_NAME = `${PAGE_CUT[0]}//${PAGE_CUT[2]}`;\r\n      pageUrl = pageUrl.replace(HOST_NAME, '');\r\n    }\r\n\r\n    // 如果来路url异常，则设置为空\r\n    if ( !fromUrl || (fromUrl && typeof fromUrl !== 'string') ) {\r\n      fromUrl = '';\r\n    }\r\n\r\n    // 如果来路url没有带上http/https，也是设置为空\r\n    if ( typeof fromUrl === 'string' && !fromUrl.includes('http') ) {\r\n      fromUrl = '';\r\n    }\r\n\r\n    // 设置响应id并提交数据\r\n    this.setAccount();\r\n\r\n    if ( fromUrl ) {\r\n      window._czc.push(['_trackPageview', pageUrl, fromUrl]);\r\n    } else {\r\n      window._czc.push(['_trackPageview', pageUrl]);\r\n    }\r\n\r\n    if ( this.isDebug ) {\r\n      console.log(`[vue-cnzz-analytics] track pv done.\\nsiteId:    ${this.siteId}\\npageUrl:   ${pageUrl}\\nfromUrl:   ${fromUrl}`);\r\n    }\r\n  }\r\n\r\n  /** \r\n   * 提交点击事件\r\n   */\r\n  trackEvent (category: string, action: string, label: string, value: number, nodeId: string) {\r\n    // 前两个是必填项\r\n    if ( typeof category !== 'string' ||  typeof action !== 'string' || !category || !action ) {\r\n      throw new Error('[vue-cnzz-analytics] Missing necessary category and operation information, and must be of type string.');\r\n      return false;\r\n    }\r\n\r\n    // 重置一些无效的默认值\r\n    if ( !label || typeof label !== 'string'  ) {\r\n      label = '';\r\n    }\r\n\r\n    if ( !Number(value) ) {\r\n      value = 0;\r\n    }\r\n\r\n    if ( !nodeId || typeof nodeId !== 'string' ) {\r\n      nodeId = '';\r\n    }\r\n\r\n    // 设置响应id并提交数据\r\n    this.setAccount();\r\n\r\n    if ( nodeId ) {\r\n      window._czc.push(['_trackEvent', category, action, label, value, nodeId]);\r\n    } else {\r\n      window._czc.push(['_trackEvent', category, action, label, value]);\r\n    }\r\n\r\n    if ( this.isDebug ) {\r\n      console.log(`[vue-cnzz-analytics] track event done.\\nsiteId:   ${this.siteId}\\ncategory: ${category}\\naction:   ${action}\\nlabel:    ${label}\\nvalue:    ${value}\\nnodeId:   ${nodeId}`);\r\n    }\r\n  }\r\n}\r\n\r\nexport default CNZZ;","import CNZZ from '@m/cnzz'\r\n\r\n/** \r\n * 定义推送操作\r\n */\r\nclass PushCNZZ {\r\n  siteIdList: number[];\r\n  isDebug: boolean;\r\n\r\n  constructor (siteIdList: number[], isDebug: boolean) {\r\n    this.siteIdList = siteIdList;\r\n    this.isDebug = isDebug;\r\n  }\r\n\r\n  /** \r\n   * 批量部署站点\r\n   */\r\n  init () {\r\n    this.siteIdList.forEach( (siteId: number) => {\r\n      const SITE = new CNZZ(siteId, this.isDebug);\r\n      SITE.init();\r\n    });\r\n  }\r\n\r\n  /** \r\n   * 批量提交pv上报\r\n   */\r\n  pv (pageUrl: string, fromUrl?: string) {\r\n    this.siteIdList.forEach( (siteId: number) => {\r\n      const SITE = new CNZZ(siteId, this.isDebug);\r\n      SITE.trackPageview(pageUrl, fromUrl);\r\n    });\r\n  }\r\n\r\n  /** \r\n   * 批量提交事件上报\r\n   */\r\n  event (category: string, action: string, label: string, value: number, nodeId: string) {\r\n    this.siteIdList.forEach( (siteId: number) => {\r\n      const SITE = new CNZZ(siteId, this.isDebug);\r\n      SITE.trackEvent(category, action, label, value, nodeId);\r\n    });\r\n  }\r\n\r\n}\r\n\r\nexport default PushCNZZ;","/** \r\n * 获取Vue的版本\r\n * @return 2=Vue2.x, 3=Vue3.x\r\n */\r\nconst getVueVersion = (Vue: Vue): number => {\r\n  let version: number = 2;\r\n\r\n  // 获取Vue的版本号\r\n  const VUE_VERSION: string = String(Vue.version);\r\n\r\n  // Vue 2.x\r\n  if ( VUE_VERSION.slice(0, 2) === '2.' ) {\r\n    version = 2; \r\n  }\r\n  \r\n  // Vue 3.x\r\n  if ( VUE_VERSION.slice(0, 2) === '3.' ) {\r\n    version = 3; \r\n  }\r\n  \r\n  return version;\r\n}\r\n\r\nexport default getVueVersion;","import PushCNZZ from '@m/pushCNZZ'\r\nimport getVueVersion from '@m/getVueVersion'\r\n\r\n/** \r\n * 定义插件\r\n */\r\nexport default function install (Vue: Vue, { router, siteIdList, isDebug = false }: Partial<Options>) {\r\n\r\n  /** \r\n   * 一些环境和参数的检查\r\n   */\r\n  if ( typeof document === 'undefined' || typeof window === 'undefined' ) {\r\n    return false;\r\n  }\r\n\r\n  if ( !router ) {\r\n    throw new Error('[vue-cnzz-analytics] Must pass a Vue-Router instance to vue-cnzz-analytics.');\r\n  }\r\n\r\n  if ( !siteIdList ) {\r\n    throw new Error('[vue-cnzz-analytics] Missing tracking domain ID, add at least one of cnzz analytics.');\r\n  }\r\n\r\n  /** \r\n   * 挂载推送的方法\r\n   */\r\n  const pushCNZZ = new PushCNZZ(siteIdList, isDebug);\r\n  \r\n  // 获取Vue版本（获取失败则默认为2）\r\n  const VUE_VERSION: number = getVueVersion(Vue) || 2;\r\n\r\n  // 2.x可以直接挂载到原型上\r\n  if ( VUE_VERSION === 2 ) {\r\n    Vue.prototype.$pushCNZZ = pushCNZZ;\r\n  }\r\n\r\n  // 3.x必须使用这个方式来挂载\r\n  if ( VUE_VERSION === 3 ) {\r\n    Vue.config.globalProperties.$pushCNZZ = pushCNZZ;\r\n  }\r\n\r\n  /** \r\n   * 部署站点并初始化\r\n   */\r\n  if ( siteIdList ) {\r\n    pushCNZZ.init();\r\n  }\r\n\r\n  /** \r\n   * 路由切换时执行PV上报\r\n   */\r\n  router.afterEach( (to: To) => {\r\n    const PAGE_PATH_DIR_COUNT = window.location.pathname.split('/').length;\r\n    const PAGE_PATH = window.location.pathname.split('/').slice(0, PAGE_PATH_DIR_COUNT - 1).join('/');\r\n    const PAGE_URL = router.mode === 'hash' ? `${PAGE_PATH}/#${to.fullPath}` : `${PAGE_PATH}${to.fullPath}`;\r\n\r\n    pushCNZZ.pv(PAGE_URL);\r\n  });\r\n}\r\n"],"names":[],"mappings":"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"}